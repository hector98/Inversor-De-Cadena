#!/usr/bin/env ruby
# frozen_string_literal: true

# bin/app_cli

$LOAD_PATH.unshift(File.expand_path('../lib', __dir__))

require 'inverse_string'
require 'colorize'

# AppCLI class
class AppCLI
  VERSION = InverseString::VERSION

  def initialize
    @verifier = Services::Verifier
    @history = []
  end

  def run
    show_banner

    loop do
      command_process
    end
  rescue Interrupt
    puts "\n Goodbye ðŸ¤ !".yellow
  end

  private

  def show_banner
    banner = <<~BANNER
      #{'=' * 50}
      #{"String Inversor version #{VERSION}".green.bold}
      #{'=' * 50}
      #{'Commands:'.cyan}
      #{' [string] - String to invert'.cyan}
      #{' --history  - Show history'.cyan}
      #{' --help     - Show help'.cyan}
      #{' --exit     - Exit program'.cyan}
      #{'-' * 50}
    BANNER
    puts banner
  end

  def command_process
    print '> '.green
    input = gets&.chomp&.strip

    command_execute(input)
  end

  def command_execute(input)
    case input
    when 'exit'
      exit_program
    when 'history'
      show_history
    when 'help'
      show_banner
    else
      process_string(input)
    end
  end

  def exit_program
    puts "\n Goodbye ðŸ¤ !".yellow
    exit
  end

  def show_history
    @history.each do |result|
      puts result.description.to_s.green
    end
  end

  def process_string(input)
    result = @verifier.verify(input)
    @history << result

    puts result.description.to_s.green
  rescue Exceptions::InvalidStringError => e
    puts e.message.to_s.red
  end
end

AppCLI.new.run if __FILE__ == $PROGRAM_NAME
